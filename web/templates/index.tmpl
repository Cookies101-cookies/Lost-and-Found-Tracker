{{define "index"}}
{{template "layout" .}}
{{end}}

{{define "content"}}
<h2>All Items</h2>

<form method="GET" action="/" style="margin: 0 0 12px 0; display: flex; gap: 8px; align-items: center;">
    <input type="text" name="q" placeholder="Search items" value="{{.Q}}" style="flex:1; padding:8px;">
    <button type="submit">Search</button>
    <input type="hidden" name="status" value="{{.Status}}">
</form>

<div style="margin-bottom:12px;">
    <a class="button" href="/?q={{.Q | urlquery}}">All</a>
    <a class="button" href="/?status=lost&q={{.Q | urlquery}}">Lost</a>
    <a class="button" href="/?status=found&q={{.Q | urlquery}}">Found</a>
    {{if .Total}}
        <span class="muted" style="margin-left:8px;">{{.Total}} result{{if ne .Total 1}}s{{end}}</span>
    {{end}}
</div>

{{if not .Items}}
    {{if .Q}}
        <p>No items match "{{.Q}}". <a href="/">Clear search</a></p>
    {{else if .Status}}
        <p>No items in "{{.Status}}". <a href="/">Show all</a></p>
    {{else}}
        <p>No items reported yet. <a href="/items/new">Be the first to post one!</a></p>
    {{end}}
{{else}}
    {{range .Items}}
        <div class="card">
            <div class="row">
                <h3><a href="/items/{{.ID}}">{{.Title}}</a></h3>
                <span class="pill {{if eq .Status "lost"}}lost{{else}}found{{end}}">{{.Status}}</span>
            </div>

            {{if .Image}}
                <img src="/static/uploads/{{.Image}}" alt="{{.Title}}" style="max-width:200px; display:block; margin-bottom:8px">
            {{end}}

            <p class="muted">Reported on {{.CreatedAt.Format "Jan 2, 2006 at 3:04 PM"}}</p>

            {{if eq .Status "found"}}
                <p class="muted">Marked as found on {{.FoundAt.Format "Jan 2, 2006 at 3:04 PM"}}</p>
            {{end}}

            <p><strong>Description:</strong> {{.Desc}}</p>
            <p><strong>Contact:</strong> {{.Contact}}</p>

            {{if .CurrentUser}}
                {{if eq .UserID .CurrentUser.ID}}
                    <form method="GET" action="/items/{{.ID}}/edit" style="margin-top:8px;">
                        <button type="submit" style="padding:4px 8px;">Edit</button>
                    </form>
                {{end}}
            {{end}}
        </div>
    {{end}}
{{end}}
{{end}}
